<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz | Qmantra‚Ñ¢</title>
  <link rel="stylesheet" href="../style.css">

  <style>
    .quiz-box {
      max-width: 600px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .option {
      display: block;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
    }
    .option:hover { background: #eef; }
    .correct { background: #d4edda; border-color: #28a745; }
    .wrong { background: #f8d7da; border-color: #dc3545; }
    .timer { font-weight: bold; color: #dc2626; }
    .explanation {
      margin-top: 10px;
      padding: 10px;
      background: #f9fafb;
      border-left: 4px solid #4f46e5;
      display: none;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      background: #5b5be0;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <h1 id="quizTitle">Qmantra‚Ñ¢ Quiz</h1>
</header>

<nav>
  <a href="../index.html">Home</a>
  <a href="index.html">Quizzes</a>
</nav>

<div class="quiz-box">
  <div class="timer">‚è± Time left: <span id="time">15</span>s</div>

  <h2 id="question">Loading...</h2>

  <label class="option">
    <input type="radio" name="option" value="0">
    <span id="opt0"></span>
  </label>
  <label class="option">
    <input type="radio" name="option" value="1">
    <span id="opt1"></span>
  </label>
  <label class="option">
    <input type="radio" name="option" value="2">
    <span id="opt2"></span>
  </label>
  <label class="option">
    <input type="radio" name="option" value="3">
    <span id="opt3"></span>
  </label>

  <div class="explanation" id="explanation"></div>
  <button onclick="nextQuestion()">Next</button>
</div>

<script>
  function saveBestScore(type, percentage) {
  const key = "bestScore_" + type;
  const oldScore = localStorage.getItem(key);

  if (!oldScore || percentage > oldScore) {
    localStorage.setItem(key, percentage);
  }
}

<script>
  const params = new URLSearchParams(window.location.search);
  const type = params.get("type") || "maths";

  let quizData = [];
  let current = 0;
  let score = 0;
  let time = 15;
  let timer;
  let answered = false; // üîí LOCK

  function saveBestScore(type, percentage) {
    const key = "bestScore_" + type;
    const old = localStorage.getItem(key);
    if (!old || percentage > old) {
      localStorage.setItem(key, percentage);
    }
  }

  document.getElementById("quizTitle").innerText =
    type === "maths" ? "üìê Maths Quiz" : "üåç GK Quiz";

  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  fetch(type + ".json")
    .then(res => res.json())
    .then(data => {
      shuffleArray(data);
      quizData = data;
      loadQuestion();
    });

  function startTimer() {
    time = 15;
    answered = false;
    document.getElementById("time").innerText = time;

    timer = setInterval(() => {
      time--;
      document.getElementById("time").innerText = time;

      if (time === 0) {
        clearInterval(timer);
        nextQuestion(true); // ‚è± timeUp
      }
    }, 1000);
  }

  function loadQuestion() {
    clearInterval(timer);

    const q = quizData[current];
    document.getElementById("question").innerText = q.question;

    q.options.forEach((opt, i) => {
      document.getElementById("opt" + i).innerText = opt;
    });

    document.getElementById("explanation").style.display = "none";

    document.querySelectorAll(".option").forEach(o => {
      o.classList.remove("correct", "wrong");
      o.querySelector("input").checked = false;
    });

    startTimer();
  }

  function nextQuestion(timeUp = false) {
    if (answered) return; // üîí prevent double scoring
    answered = true;

    clearInterval(timer);

    const selected = document.querySelector('input[name="option"]:checked');
    const options = document.querySelectorAll(".option");

    const correctIndex = quizData[current].answer;

    options.forEach((label, i) => {
      if (i === correctIndex) label.classList.add("correct");
      if (!timeUp && selected && i === +selected.value && i !== correctIndex) {
        label.classList.add("wrong");
      }
    });

    if (
      !timeUp &&
      selected &&
      current < quizData.length &&
      +selected.value === correctIndex
    ) {
      score++;
    }

    const exp = document.getElementById("explanation");
    exp.innerText = "Explanation: " + quizData[current].explanation;
    exp.style.display = "block";

    setTimeout(() => {
      current++;

      if (current < quizData.length) {
        loadQuestion();
      } else {
        if (score > quizData.length) score = quizData.length;

        const percentage = Math.round((score / quizData.length) * 100);
        saveBestScore(type, percentage);

        const best = localStorage.getItem("bestScore_" + type);

        document.querySelector(".quiz-box").innerHTML = `
          <h2>Quiz Completed üéâ</h2>
          <p><b>Score:</b> ${score}/${quizData.length}</p>
          <p><b>Percentage:</b> ${percentage}%</p>
          <p><b>Best Score:</b> ${best}%</p>
          <a href="index.html">Back to Quizzes</a>
        `;
      }
    }, 1500);
  }
</script>
  
