<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz | Qmantra‚Ñ¢</title>
  <link rel="stylesheet" href="../style.css">

  <style>
    .quiz-box {
      max-width: 600px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .option {
      display: block;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
    }
    .option:hover { background: #eef; }
    .correct { background: #d4edda; border-color: #28a745; }
    .wrong { background: #f8d7da; border-color: #dc3545; }
    .timer { font-weight: bold; color: #dc2626; }
    .explanation {
      margin-top: 10px;
      padding: 10px;
      background: #f9fafb;
      border-left: 4px solid #4f46e5;
      display: none;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      background: #5b5be0;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .quit-btn {
  background: #dc2626;
}

  </style>
</head>
<body>

<header>
  <h1 id="quizTitle">Qmantra‚Ñ¢ Quiz</h1>
</header>

<nav>
  <a href="../index.html">Home</a>
  <a href="index.html">Quizzes</a>
</nav>

<div class="quiz-box" id="quizBox">
  <div class="timer">‚è± Time left: <span id="time">15</span>s</div>

  <h2 id="question">Loading...</h2>

  <label class="option">
    <input type="radio" name="option" value="0">
    <span id="opt0"></span>
  </label>
  <label class="option">
    <input type="radio" name="option" value="1">
    <span id="opt1"></span>
  </label>
  <label class="option">
    <input type="radio" name="option" value="2">
    <span id="opt2"></span>
  </label>
  <label class="option">
    <input type="radio" name="option" value="3">
    <span id="opt3"></span>
  </label>

  <div class="explanation" id="explanation"></div>

 <div class="quiz-actions">
  <button class="btn-next" onclick="nextQuestion()">Next</button>
  <button class="btn-quit" onclick="quitQuiz()">Quit Quiz</button>
</div>


<script>
  const params = new URLSearchParams(window.location.search);
  const type = params.get("type") || "maths";

  let quizData = [];
  let current = 0;
  let score = 0;
  let time = 60;
  let timer;
  let answered = false;

  document.getElementById("quizTitle").innerText =
    type === "maths" ? "üìê Maths Quiz" : "üåç GK Quiz";

  fetch("./" + type + ".json")
    .then(res => {
      if (!res.ok) throw new Error("JSON not found");
      return res.json();
    })
    .then(data => {
      quizData = data;
      loadQuestion();
    })
    .catch(() => {
      document.getElementById("question").innerText =
        "‚ö†Ô∏è Failed to load quiz questions.";
    });

  function startTimer() {
    time = 60;
    document.getElementById("time").innerText = time;

    timer = setInterval(() => {
      time--;
      document.getElementById("time").innerText = time;

      if (time === 0) {
        clearInterval(timer);
        showAnswer();
      }
    }, 1000);
  }

  function loadQuestion() {
    if (!quizData.length || current >= quizData.length) return;

    clearInterval(timer);
    answered = false;

    const q = quizData[current];
    document.getElementById("question").innerText = q.question;

    q.options.forEach((opt, i) => {
      document.getElementById("opt" + i).innerText = opt;
    });

    document.getElementById("explanation").style.display = "none";

    document.querySelectorAll(".option").forEach(o => {
      o.classList.remove("correct", "wrong");
    });

    document.querySelectorAll('input[name="option"]').forEach(i => i.checked = false);

    startTimer();
  }

  function showAnswer() {
    if (answered) return;
    answered = true;

    clearInterval(timer);

    const selected = document.querySelector('input[name="option"]:checked');
    const options = document.querySelectorAll(".option");
    const correctIndex = quizData[current].answer;

    options.forEach((label, i) => {
      if (i === correctIndex) label.classList.add("correct");
      if (selected && i === +selected.value && i !== correctIndex)
        label.classList.add("wrong");
    });

    if (selected && +selected.value === correctIndex) {
      score++;
    }

    document.getElementById("explanation").innerText =
      "Explanation: " + quizData[current].explanation;
    document.getElementById("explanation").style.display = "block";
  }

  function nextQuestion() {
    showAnswer();

    setTimeout(() => {
      current++;

      if (current < quizData.length) {
        loadQuestion();
      } else {
        const percent = Math.round((score / quizData.length) * 100);
        document.getElementById("quizBox").innerHTML = `
          <h2>Quiz Completed üéâ</h2>
          <p><b>Score:</b> ${score} / ${quizData.length}</p>
          <p><b>Percentage:</b> ${percent}%</p>
          <a href="index.html">Back to Quizzes</a>
        `;
      }
    }, 1500);
  }

  function quitQuiz() {
    if (!confirm("Are you sure you want to quit the quiz?")) return;

    clearInterval(timer);

    document.getElementById("quizBox").innerHTML = `
      <h2>Quiz Quit üö™</h2>
      <p><b>Questions Attempted:</b> ${current}</p>
      <p><b>Score:</b> ${score}</p>
      <a href="index.html">Back to Quizzes</a>
    `;
  }
</script>

<footer>
  <p>¬© 2025 Qmantra‚Ñ¢</p>
</footer>

</body>
</html>
