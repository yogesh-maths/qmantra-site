<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Test Result | Qmantra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<header class="site-header">
  <h1>Mock Test Result</h1>
</header>

<nav>
  <a href="./index.html">Back</a>
</nav>

<main class="page-content">

  <div class="result-summary">
    <h2 id="scoreText"></h2>
    <canvas id="resultChart" width="300"></canvas>
  </div>

  <hr>

  <div id="explanationBox"></div>

</main>

<script>
  const result = JSON.parse(localStorage.getItem("mockResult"));

  if (!result) {
    document.body.innerHTML = "<p>No result found</p>";
  }

  const correct = result.score;
  const wrong = result.total - result.score;

  document.getElementById("scoreText").innerText =
    `Score: ${correct} / ${result.total} (${result.percent}%)`;

  // PIE CHART
  new Chart(document.getElementById("resultChart"), {
    type: "pie",
    data: {
      labels: ["Correct", "Wrong"],
      datasets: [{
        data: [correct, wrong]
      }]
    }
  });

  // EXPLANATION
  const box = document.getElementById("explanationBox");

  result.questions.forEach((q, i) => {
    const userAns = result.userAnswers[i];
    const isCorrect = userAns === q.correctAnswer;

    box.innerHTML += `
      <div class="explain-card">
        <h3>Q${i + 1}. ${q.question}</h3>
        <p><b>Your Answer:</b> ${q.options[userAns] || "Not Answered"}</p>
        <p><b>Correct Answer:</b> ${q.options[q.correctAnswer]}</p>
        <p><b>Explanation:</b> ${q.explanation || "—"}</p>
        <p style="color:${isCorrect ? 'green' : 'red'}">
          ${isCorrect ? "✔ Correct" : "✘ Wrong"}
        </p>
      </div>
      <hr>
    `;
  });
</script>

</body>
</html>
