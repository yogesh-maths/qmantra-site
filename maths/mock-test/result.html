<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Test Result | Qmantra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="../../style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <h1>Mock Test Result</h1>
    <p>Performance Analysis & Solutions</p>
  </div>
</header>

<nav>
  <a href="/qmantra-site/">Home</a>
  <a href="/qmantra-site/maths/">Maths</a>
  <a href="/qmantra-site/maths/mock-test/">Mock Test</a>
</nav>

<main class="page-content">

  <!-- SUMMARY -->
  <section class="note-card" style="text-align:center;">
    <h2>üìä Test Summary</h2>

    <p id="scoreText"></p>

    <div style="max-width:320px;margin:20px auto;">
      <canvas id="resultChart"></canvas>
    </div>

    <button onclick="restartTest()" class="btn-primary">
      üîÅ Restart Test
    </button>
  </section>

  <!-- ANSWER REVIEW -->
  <section class="note-card">
    <h2>üìù Detailed Solutions</h2>
    <div id="answerList"></div>
  </section>

</main>

<footer class="site-footer">
  <p>¬© 2025 Qmantra‚Ñ¢. All rights reserved.</p>
</footer>

<script>
/* =========================
   LOAD RESULT
========================= */
const result = JSON.parse(sessionStorage.getItem("mockResult"));

if (!result) {
  alert("No result found");
  window.location.href = "/qmantra-site/";
}

/* =========================
   CALCULATIONS
========================= */
const attempted = result.correct + result.wrong;
const skipped = result.total - attempted;

const accuracy = attempted === 0
  ? 0
  : Math.round((result.correct / attempted) * 100);

/* =========================
   SUMMARY TEXT
========================= */
document.getElementById("scoreText").innerHTML = `
  <strong>Total Questions:</strong> ${result.total}<br>
  <strong>Attempted:</strong> ${attempted}<br>
  <strong>Correct:</strong> ${result.correct}<br>
  <strong>Wrong:</strong> ${result.wrong}<br>
  <strong>Unattempted:</strong> ${skipped}<br>
  <strong>Accuracy:</strong> ${accuracy}%
`;

/* =========================
   PIE CHART
========================= */
new Chart(document.getElementById("resultChart"), {
  type: "pie",
  data: {
    labels: ["Correct", "Wrong", "Unattempted"],
    datasets: [{
      data: [result.correct, result.wrong, skipped],
      backgroundColor: ["#22c55e", "#ef4444", "#9ca3af"]
    }]
  },
  options: {
    plugins: {
      legend: {
        position: "bottom"
      }
    }
  }
});

/* =========================
   ANSWER REVIEW
========================= */
const answerList = document.getElementById("answerList");

result.questions.forEach((q, i) => {
  const userAns = q.user !== null ? q.options[q.user] : "Not Attempted";
  const correctAns = q.options[q.correct];

  const div = document.createElement("div");
  div.style.marginBottom = "20px";

  div.innerHTML = `
    <p><strong>Q${i + 1}. ${q.question}</strong></p>

    <p>
      üßë Your Answer:
      <span style="color:${userAns === correctAns ? 'green' : 'red'}">
        ${userAns}
      </span>
    </p>

    <p>‚úÖ Correct Answer: <strong>${correctAns}</strong></p>

    <p style="color:#4b5563;">
      üìò ${q.explanation ? q.explanation : "Explanation not available"}
    </p>

    <hr>
  `;

  answerList.appendChild(div);
});

/* =========================
   RESTART
========================= */
function restartTest() {
  sessionStorage.removeItem("mockResult");
  window.location.href = "/qmantra-site/maths/mock-test/";
}
</script>

</body>
</html>
