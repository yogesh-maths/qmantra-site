<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Test Result | Qmantra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- MathJax for LaTeX support -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$']],
      displayMath: [['$$', '$$']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

</head>

<body>

<header class="site-header">
  <h1>Mock Test Result</h1>
</header>

<nav>
  <a href="./index.html">← Back to Mock Tests</a>
</nav>

<main class="page-content">

  <!-- SUMMARY -->
  <section class="result-summary">
    <div class="score-box">
      <h2 id="scoreText"></h2>
      <p id="attemptText"></p>
    </div>

    <div class="chart-box">
      <canvas id="resultChart" width="220" height="220"></canvas>
    </div>
  </section>

  <!-- ANSWER REVIEW -->
  <section class="answer-review" id="answerReview"></section>

</main>

<script>
  const result = JSON.parse(localStorage.getItem("mockResult"));

  if (!result) {
    document.body.innerHTML = "<p>No result found</p>";
  }

  const correct = result.score;
  const attempted = result.attempted;
  const wrong = attempted - correct;
  const skipped = result.total - attempted;

  document.getElementById("scoreText").innerText =
    `Score: ${correct} / ${result.total} (${result.percent}%)`;

  document.getElementById("attemptText").innerText =
    `Attempted: ${attempted}, Correct: ${correct}, Wrong: ${wrong}, Skipped: ${skipped}`;

  /* PIE CHART (SMALL & CLEAN) */
  new Chart(document.getElementById("resultChart"), {
    type: "pie",
    data: {
      labels: ["Correct", "Wrong", "Not Attempted"],
      datasets: [{
        data: [correct, wrong, skipped],
        backgroundColor: ["#22c55e", "#ef4444", "#9ca3af"]
      }]
    },
    options: {
      plugins: {
        legend: {
          position: "bottom"
        }
      }
    }
  });

  /* ANSWER + EXPLANATION */
  const review = document.getElementById("answerReview");

  result.questions.forEach((q, i) => {
    const userAns = result.userAnswers[i];
    const correctAns = q.correctAnswer;

    const div = document.createElement("div");
    div.className = "answer-card";

    div.innerHTML = `
      <h4>Q${i + 1}. ${q.question}</h4>
      <p>
        <b>Your Answer:</b>
        <span class="${userAns === correctAns ? 'correct-text' : 'wrong-text'}">
          ${userAns !== undefined ? q.options[userAns] : 'Not Attempted'}
        </span>
      </p>
      <p>
        <b>Correct Answer:</b>
        <span class="correct-text">${q.options[correctAns]}</span>
      </p>
      <p class="explanation">
        <b>Explanation:</b> ${q.explanation || "—"}
      </p>
    `;

    review.appendChild(div);
  });
</script>

</body>
</html>
