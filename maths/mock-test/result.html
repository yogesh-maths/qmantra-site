<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Test Result | Qmantra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="../../style.css">

  <!-- Chart.js -->
  
<script>
document.addEventListener("DOMContentLoaded", () => {

  const result = JSON.parse(sessionStorage.getItem("mockResult"));

  if (!result) {
    alert("No result found");
    window.location.href = "/qmantra-site/";
    return;
  }

  const attempted = result.correct + result.wrong;
  const skipped = result.total - attempted;

  document.getElementById("scoreText").innerHTML = `
    <strong>Total:</strong> ${result.total}<br>
    <strong>Correct:</strong> ${result.correct}<br>
    <strong>Wrong:</strong> ${result.wrong}<br>
    <strong>Skipped:</strong> ${skipped}<br>
    <strong>Accuracy:</strong> ${Math.round((result.correct / result.total) * 100)}%
  `;

  const ctx = document.getElementById("resultChart").getContext("2d");

  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Correct", "Wrong", "Unattempted"],
      datasets: [{
        data: [result.correct, result.wrong, skipped],
        backgroundColor: ["#22c55e", "#ef4444", "#9ca3af"]
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "bottom" } }
    }
  });

  const list = document.getElementById("answerList");

  result.questions.forEach((q, i) => {
    const userText = q.user !== null ? q.options[q.user] : "Not Attempted";
    const correctText = q.options[q.correct];

    list.innerHTML += `
      <div style="margin-bottom:16px;">
        <p><b>Q${i + 1}. ${q.question}</b></p>
        <p>ðŸ§‘ Your Answer: <span style="color:${userText === correctText ? 'green' : 'red'}">${userText}</span></p>
        <p>âœ… Correct Answer: <b>${correctText}</b></p>
        <p style="color:#555;">ðŸ“˜ ${q.explanation}</p>
        <hr>
      </div>
    `;
  });

});
</script>

   
/* =========================
   LOAD RESULT
========================= */
const result = JSON.parse(sessionStorage.getItem("mockResult"));

if (!result) {
  alert("No result found");
  window.location.href = "/qmantra-site/";
}

/* =========================
   CALCULATIONS
========================= */
const attempted = result.correct + result.wrong;
const skipped = result.total - attempted;

const accuracy = attempted === 0
  ? 0
  : Math.round((result.correct / attempted) * 100);

/* =========================
   SUMMARY TEXT
========================= */
document.getElementById("scoreText").innerHTML = `
  <strong>Total Questions:</strong> ${result.total}<br>
  <strong>Attempted:</strong> ${attempted}<br>
  <strong>Correct:</strong> ${result.correct}<br>
  <strong>Wrong:</strong> ${result.wrong}<br>
  <strong>Unattempted:</strong> ${skipped}<br>
  <strong>Accuracy:</strong> ${accuracy}%
`;

/* =========================
   PIE CHART
========================= */
new Chart(document.getElementById("resultChart"), {
  type: "pie",
  data: {
    labels: ["Correct", "Wrong", "Unattempted"],
    datasets: [{
      data: [result.correct, result.wrong, skipped],
      backgroundColor: ["#22c55e", "#ef4444", "#9ca3af"]
    }]
  },
  options: {
    plugins: {
      legend: {
        position: "bottom"
      }
    }
  }
});

/* =========================
   ANSWER REVIEW
========================= */
const answerList = document.getElementById("answerList");

result.questions.forEach((q, i) => {
  const userAns = q.user !== null ? q.options[q.user] : "Not Attempted";
  const correctAns = q.options[q.correct];

  const div = document.createElement("div");
  div.style.marginBottom = "20px";

  div.innerHTML = `
    <p><strong>Q${i + 1}. ${q.question}</strong></p>

    <p>
      ðŸ§‘ Your Answer:
      <span style="color:${userAns === correctAns ? 'green' : 'red'}">
        ${userAns}
      </span>
    </p>

    <p>âœ… Correct Answer: <strong>${correctAns}</strong></p>

    <p style="color:#4b5563;">
      ðŸ“˜ ${q.explanation ? q.explanation : "Explanation not available"}
    </p>

    <hr>
  `;

  answerList.appendChild(div);
});

/* =========================
   RESTART
========================= */
function restartTest() {
  sessionStorage.removeItem("mockResult");
  window.location.href = "/qmantra-site/maths/mock-test/";
}
</script>

</body>
</html>
