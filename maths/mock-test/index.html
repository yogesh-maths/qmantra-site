<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Tests | Qmantra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../style.css">
</head>

<body>

<header class="site-header">
  <h1>Maths Mock Tests</h1>
  <p>Free mock tests based on competitive exam pattern</p>
</header>

<nav>
  <a href="/qmantra-site/">Home</a>
  <a href="/qmantra-site/maths/">Maths</a>
</nav>

<main class="page-content">

  <h2 class="section-title">Available Mock Tests</h2>

  <div class="mock-grid" id="mockGrid"></div>

</main>

<script>
fetch("./data/mock-list.json")
  .then(res => res.json())
  .then(mocks => {
    const grid = document.getElementById("mockGrid");

    // newest first
    mocks.sort((a, b) =>
      new Date(b.updatedOn) - new Date(a.updatedOn)
    );

    mocks.forEach(mock => {
      const daysOld =
        (new Date() - new Date(mock.updatedOn)) / 86400000;

      const isNew = daysOld <= 7;

      const card = document.createElement("a");
      card.className = "mock-card";
      card.href = `./mcq.html?test=${mock.id}`;

      card.innerHTML = `
        ${isNew ? `<span class="badge new">NEW</span>` : ``}
        <h3>${mock.title}</h3>
        <p>${mock.description}</p>
        <span class="mock-link">Start Mock Test →</span>
      `;

      grid.appendChild(card);
    });
  });
</script>


<!-- ✅ AUTO NEW + AUTO SORT -->
<script>
(async function () {
  const grid = document.querySelector(".mock-grid");
  if (!grid) return;

  const cards = Array.from(grid.children);

  await Promise.all(cards.map(async card => {
    const jsonUrl = card.dataset.json;
    if (!jsonUrl) return;

    try {
      const res = await fetch(jsonUrl);
      const data = await res.json();
      const updatedOn = data.meta?.updatedOn;
      if (!updatedOn) return;

      const days =
        (new Date() - new Date(updatedOn)) / (1000 * 60 * 60 * 24);

      if (days <= 7) {
        card.dataset.new = "true";
        const badge = card.querySelector(".badge.new");
        if (badge) badge.style.display = "inline-block";
      } else {
        card.dataset.new = "false";
      }
    } catch {}
  }));

  cards.sort((a, b) =>
    (b.dataset.new === "true") - (a.dataset.new === "true")
  );

  cards.forEach(card => grid.appendChild(card));
})();
</script>

</body>
</html>
